#
# Makefile for pugixml
#

CACTUS_ROOT = $(shell cd)\..\..

include $(CACTUS_ROOT)\config\Makefile.win.macros

Package = extern\pugixml
PackagePath = $(CACTUS_BUILD_ROOT)\${Package}
PackageName = cactus-extern-pugixml

Packager = Andrew Rose, Marc Magrans de Abril

PACKAGE_VER_MAJOR = 1
PACKAGE_VER_MINOR = 0
PACKAGE_RELEASE = 0

LIBRARY = libcactus_extern_pugixml.dll

ZIP_NAME = pugixml-${PACKAGE_VER_MAJOR}.${PACKAGE_VER_MINOR}
ZIP_FILE = ${ZIP_NAME}.zip

MSBUILD_DIR = ${PackagePath}\MSBUILD

.PHONY: all _all clean _cleanall build _buildall install _installall rpm _rpmall test _testall

default: build

clean: _cleanall
_cleanall:
	rm -rf ${MSBUILD_DIR}
	rm -rf ${ZIP_NAME}

all: _all
build: _all
buildall: _all
_all:
	if not exist ${ZIP_NAME}\.windows_build_done ( \
		mkdir ${ZIP_NAME} & 												\
		7z x -y -o${ZIP_NAME} ${ZIP_FILE} > NUL & 									\
		cd ${ZIP_NAME} &													\
		g++ -O3 -shared -o ${LIBRARY} src\pugixml.cpp &				\
		xcopy /Y ${LIBRARY} ${MSBUILD_DIR}\SOURCES\lib\ &						\
		xcopy /Y src\*.hpp ${MSBUILD_DIR}\SOURCES\include\pugixml\ &			\
		echo %DATE% %TIME% > .windows_build_done \
	) 

#		mkdir -p ${MSBUILD_DIR}\{RPMS\{i386,i586,i686,x86_64},SPECS,BUILD,SOURCES,SRPMS} &  \
#		mkdir -p ${MSBUILD_DIR}\SOURCES\{lib,include\pugixml} &                             \

		
# rpm: _rpmall
# _rpmall: 
#	 rpmbuild -bb -bl --buildroot=${MSBUILD_DIR}\BUILD				\
#			 --define  "_topdir ${MSBUILD_DIR}"				\
#			 --define "_prefix ${INSTALL_PREFIX}"				\
#			 --define "zip_file ${ZIP_FILE}"					\
#			 --define "sources_dir ${MSBUILD_DIR}\SOURCES"			\
#			 --define "name ${PackageName}"					\
#			 --define "version ${PACKAGE_VER_MAJOR}.${PACKAGE_VER_MINOR}"	\
#			 --define "release ${PACKAGE_RELEASE}"				\
#			 --define "packager ${Packager}"					\
#			 cactus-extern-pugixml.spec

