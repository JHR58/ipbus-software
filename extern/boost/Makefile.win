#
# Makefile for boost
#

CACTUS_ROOT = $(shell cd)\..\..

include $(CACTUS_ROOT)\config\Makefile.win.macros

Package = extern\boost
PackagePath = $(CACTUS_RPM_ROOT)\${Package}
PackageName = cactuscore-extern-boost

Packager = Andrew Rose, Marc Magrans de Abril

PACKAGE_VER_MAJOR = 1
PACKAGE_VER_MINOR = 48
PACKAGE_VER_PATCH = 0
PACKAGE_RELEASE = 2

TARBALL_NAME = boost_${PACKAGE_VER_MAJOR}_${PACKAGE_VER_MINOR}_${PACKAGE_VER_PATCH}
TARBALL_FILE = ${TARBALL_NAME}.tar
ZIPPED_TARBALL_FILE = ${TARBALL_FILE}.bz2

MSBUILD_DIR = ${PackagePath}\MSBUILD

.PHONY: all _all clean _cleanall build _buildall install _installall rpm _rpmall test _testall

default: build

clean: _cleanall
_cleanall:
	rm -rf ${MSBUILD_DIR}
	rm -rf ${TARBALL_NAME}

all: _all
build: _all
buildall: _all
_all:

#		mkdir -p ${MSBUILD_DIR}\{RPMS\{i386,i586,i686,x86_64},SPECS,BUILD,SOURCES,SRPMS}; 

	if not exist ${TARBALL_NAME}\.windows_build_done ( \
		echo "Extracting: ${TARBALL_FILE}" & \
		7z x -y ${ZIPPED_TARBALL_FILE} > NUL & \
		7z x -y ${TARBALL_FILE} > NUL & \
		rm -f ${TARBALL_FILE} & \
		cd ${TARBALL_NAME} & \
		bootstrap.bat & \
		b2	-d0										\
			--without-mpi							\
			--layout=system							\
			--prefix=${MSBUILD_DIR}\SOURCES			\
			--exec-prefix=${MSBUILD_DIR}\SOURCES	\
			toolset=gcc								\
			variant=release							\
			link=shared								\
			threading=multi							\
			install & \
		echo %DATE% %TIME% > .windows_build_done \
	)

#rpm: _rpmall
#_rpmall: 
#	RPMBUILD -bb -bl --buildroot=${MSBUILD_DIR}\BUILD						\
#			--define  "_topdir ${MSBUILD_DIR}"						\
#			--define "_prefix ${INSTALL_PREFIX}"							\
#			--define "tarball_file ${TARBALL_NAME}.tar.bz2"							\
#			--define "sources_dir ${MSBUILD_DIR}\SOURCES"					\
#			--define "name ${PackageName}"								\
#			--define "version ${PACKAGE_VER_MAJOR}.${PACKAGE_VER_MINOR}.${PACKAGE_VER_PATCH}"	\
#			--define "release ${PACKAGE_RELEASE}"							\
#			--define "packager ${Packager}"								\
#			cactuscore-extern-boost.spec

